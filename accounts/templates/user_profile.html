{% load static %}
<!DOCTYPE html>
<html>
<head>
	<title>{{user}}'s Profile</title>
	<link href="https://fonts.googleapis.com/css2?family=Mulish:wght@400;700&display=swap" rel="stylesheet">
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
	<style type="text/css">
		body{
			background: #000;
			color: #7ef972;
			font-family: 'Mulish',sans-serif;
		}
		.navbar-brand{
			color: inherit;
		}
		.navbar-toggler{
			display: flex;
			flex-direction: column;
		}
		.navbar-icon{
			width: 30px;
			height: 2px;
			background: #7ed957;
			border: 1px solid #7ed957;
			margin: 3px;
		}
		.navbar a{
			color: inherit;
			font-weight: 400;
			font-family: 'Muli','Mulish',sans-serif;
		}
		.btn-login{
			border-radius: 20px;
		}
		.badge-success{
			background: #7ef972;
			color: #000;
			padding: 5px 20px;
			width: 150px;
		}
		.card{
			background: #7ed957;
			color: #000;
			border: none;
			font-weight: 800;
		}
		.card-body, .card-header, .card-footer{
			border: 1px solid #000;
		}
		.card-title{
			margin-bottom: 0;
		}
		.card-header{
			padding: .25rem 1.25rem;
		}
		.follow-btn{
			border: none;
			background: var(--white);
			color: #0095f6;
			transition: all cubic-bezier(0.45, 0.05, 0.55, 0.95) 0.4s;
			padding: 3px 12px;
			font-weight: 700;
			border-radius: 5px;
			text-decoration: none;
		}
		.follow-btn:hover{
			background: #0095f6;
			color: var(--white);
			text-decoration: none;
			outline: 0;
		}
		.following-btn{
			border: none;
			background: #0095f6;
			color: var(--white);
			transition: all ease-in-out 0.4s;
			padding: 3px 12px;
			font-weight: 700;
			border-radius: 5px;
			text-decoration: none;
		}
		.following-btn:hover{
			background: var(--white);
			color: #0095f6;
			outline: 0;
			text-decoration: none;
		}
		.table thead th{
			border: none;
			color: #7ef972;
		}
		.table td, .table th{
			border: none;
			color: #7ef972;
		}
		#posts_count, #followers, #following{
			border: none;
			background: #7ef972;
			color: #000;
			transition: all ease-in-out 0.4s;
			padding: 3px 12px;
			font-weight: 700;
			border-radius: 5px;
			width: 60px;
			text-decoration: none;	
		}
	</style>
</head>
<body>
	{% include "navbar.html" %}
	<hr style="border: 1px solid #fff;margin-top: 3px;">
<div class="container">
		<h4 id="profile_picture"><img style="width: 50px;height: 50px;border-radius: 50%;" src="static/{{user.profile_picture}}" class="img-fluid"><span class="ml-4">{{ user }}</span></h4>
		<span class="float-right" style="margin-top: -50px;">
			{% if sameUser %}
				<a href="{% url 'edit_profile' %}" class="follow-btn">Edit Profile</a>
				{% else %}
					{% if canFollow %}
					<button class="follow-btn">{{text}}</button>
					{% else %}
					<button class="following-btn">{{text}}</button>
				{% endif %}    	
			{% endif %}	
			
		</span>
		<div class="bio" style="max-width: 400px;">
		<span id="bio">{{ user.bio|linebreaks }}<br/><h3 id="website"><a href="{{user.website}}">{{ user.website }}</a></h3></span>
		</div>
		<table class="table text-center">
			<thead>
				<th style="width: 33vw;"><span id="posts_count">Posts</span></th>
				<th style="width: 33vw;"><span id="followers">Followers</span></th>
				<th style="width: 33vw;"><span id="following">Following</span></th>
			</thead>
			<tr class="col">
				<td>{{posts.count}}</td>
				<td id="followers_count">{{user.followers.count}}</td>
				<td>{{user.following.count}}</td>
			</tr>
		</table>
		<hr style="border: .5px solid #7ef972">
</div>
<div class="container">
	<h3>{{user}}'s Posts</h3>
		{% for post in posts %}
			<div class="card">
				<div class="card-header">
					<p class="card-title">{{ post.title }}</p>
				</div>
				<div class="card-body">
					<p>{{ post.content |slice:":100" | linebreaks }}</p>
					<p>- {{ post.created_on }} by <a href="/{{ post.author }}" style="color: inherit;text-decoration:none;border-bottom: 2px solid #000">{{ post.author }}</a></p>
				</div>
				<div class="card-footer">
					<a href="/{{ post.author }}/posts/{{ post.url }}/" class="btn-login" style="max-width: 8rem;background: #000;color: #7ed957;text-decoration: none;padding: 2px 10px;">Read More</a>
				</div>
			</div>
			<br/>
		{% endfor %}
</div>
<script type="text/javascript">
	var following = {{following}};
	var follow_btn = document.getElementsByTagName('BUTTON')[1];
	var init_text = "{{text}}"
	var followers = document.querySelector('#followers_count');
	function checkFollowing(){
		if(following){
		var x = document.querySelector('.following-btn');
		x.onclick = function(){
		var xhttp = new XMLHttpRequest();
	  	xhttp.onreadystatechange = function() {
	    if (this.readyState == 4 && this.status == 200) {
	      	x.classList.add('follow-btn')
	      	x.classList.remove('following-btn')
	      	x.innerText = "Follow"
	      	following = false;
	      	followers.innerText = parseInt(followers.innerText)-1;
	      	checkFollowing();
	    	}
		};
		xhttp.open("GET", "/unfollow/{{user}}", true);
		xhttp.send();
		}
		}
		else{
			var x = document.querySelector('.follow-btn');
			x.onclick = function(){
			var xhttp = new XMLHttpRequest();
		  	xhttp.onreadystatechange = function() {
		    if (this.readyState == 4 && this.status == 200) {
		      	x.classList.add('following-btn')
		      	x.classList.remove('follow-btn')
		      	x.innerText = "Following"
		      	following = true;
		      	followers.innerText = parseInt(followers.innerText)+1;
		      	checkFollowing();
		    }
		};
		xhttp.open("GET", "/follow/{{user}}", true);
		xhttp.send();
		}
	}	
	}
	if(following){
		var x = document.querySelector('.following-btn');
		x.onclick = function(){
		var xhttp = new XMLHttpRequest();
	  	xhttp.onreadystatechange = function() {
	    if (this.readyState == 4 && this.status == 200) {
	      	x.classList.add('follow-btn')
	      	x.classList.remove('following-btn')
	      	x.innerText = "Follow"
	      	followers.innerText = parseInt(followers.innerText)-1;
	      	following = false
	      	checkFollowing()
	    	}
		};
		xhttp.open("GET", "/unfollow/{{user}}", true);
		xhttp.send();
		}
		}
		else{
			var x = document.querySelector('.follow-btn');
			x.onclick = function(){
			var xhttp = new XMLHttpRequest();
		  	xhttp.onreadystatechange = function() {
		    if (this.readyState == 4 && this.status == 200) {
		      	x.classList.add('following-btn')
		      	x.classList.remove('follow-btn')
		      	x.innerText = "Following"
		      	following = true
		      	followers.innerText = parseInt(followers.innerText)+1;
		      	checkFollowing()
		    }
		};
		xhttp.open("GET", "/follow/{{user}}", true);
		xhttp.send();
		}
	}

</script>
</body>
</html>